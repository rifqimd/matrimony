{"version":3,"file":"license.js","mappings":"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","sources":["webpack://audio-player/../utils/license/license.js","webpack://audio-player/./src/js/license.js"],"sourcesContent":["// import \"./license.scss\";\r\n\r\nclass LicenseHandler {\r\n  constructor(modal, options = {}) {\r\n    if (!modal) {\r\n      console.error(\"modal undefined\");\r\n      return;\r\n    }\r\n    const { products = [], prefix, info = {}, db = \"pdfposter\" } = options;\r\n\r\n    this.endpoint = \"https://api.bplugins.com/wp-json/license/v1/gumroad\";\r\n    this.prefix = prefix;\r\n    this.modal = modal;\r\n    this.info = info;\r\n    this.db = db;\r\n\r\n    const opener = document.querySelector(`.${this.prefix}_modal_opener`); //mpafe_modal_opener\r\n    const closer = modal.querySelector(\".closer\");\r\n    const agree = modal.querySelector(\".agree\");\r\n    const activateBtn = modal.querySelector(\".btn-activate\");\r\n    const deactivateBtn = modal.querySelector(\".btn-deactivate\");\r\n    const loader = modal.querySelector(\".bpl_loader\");\r\n    this.headers = { \"content-Type\": \"application/json\" };\r\n    // this.checking = false;\r\n\r\n    window.modal = modal;\r\n    window.license = this;\r\n\r\n    if (!opener) console.error(\"opener not found\");\r\n    if (!closer) console.error(\"closer not found\");\r\n    if (!loader) console.error(\"loader not found\");\r\n\r\n    opener?.addEventListener(\"click\", (e) => {\r\n      e.preventDefault();\r\n      modal.style.display = \"block\";\r\n    });\r\n\r\n    closer?.addEventListener(\"click\", (e) => {\r\n      e.preventDefault();\r\n      modal.style.display = \"none\";\r\n    });\r\n\r\n    agree?.addEventListener(\"click\", function () {\r\n      activateBtn.disabled = !agree?.checked;\r\n    });\r\n\r\n    activateBtn?.addEventListener(\"click\", async (e) => {\r\n      e.preventDefault();\r\n      loader.style.display = \"inline-block\";\r\n      activateBtn.disabled = true;\r\n      const field = modal.querySelector(\"input.license_key\");\r\n      if (field?.value) {\r\n        const activate = await this.activeLicense(field?.value, products);\r\n        if (activate) {\r\n          this.setNotice(\"notice-success\", \"Plugin Activated!, Thank you\");\r\n        }\r\n        //  else {\r\n        //   this.setNotice(\"notice-warning\", \"Something went wrong!\");\r\n        // }\r\n      } else {\r\n        this.setNotice(\"notice-warning\", \"Please input a license key\");\r\n      }\r\n\r\n      activateBtn.disabled = false;\r\n      loader.style.display = \"none\";\r\n    });\r\n\r\n    deactivateBtn?.addEventListener(\"click\", async (e) => {\r\n      e.preventDefault();\r\n      loader.style.display = \"inline-block\";\r\n      deactivateBtn.disabled = true;\r\n\r\n      const field = modal.querySelector(\"input.license_key\");\r\n      if (field?.value) {\r\n        const deactivate = await this.deactiveLicense(field?.value, products);\r\n        if (deactivate) {\r\n          this.setNotice(\"notice-success\", \"License key deactivated.\");\r\n        }\r\n      }\r\n\r\n      deactivateBtn.disabled = false;\r\n      loader.style.display = \"none\";\r\n    });\r\n  }\r\n\r\n  verifyGumroad = async (products = [], key) => {\r\n    let response = {};\r\n    for (let product of products) {\r\n      let res = await fetch(\"https://api.gumroad.com/v2/licenses/verify\", {\r\n        method: \"POST\",\r\n        headers: { \"content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ product_permalink: product, license_key: key }),\r\n      })\r\n        .then((res) => res.json())\r\n        .then((res) => res);\r\n      if (res.success) {\r\n        response = res;\r\n        break;\r\n      }\r\n    }\r\n    const quantity = this.getQuantity(response);\r\n    const isAppSumo = response?.purchase?.product_name?.includes(\"Sumo\") || false;\r\n    const permalink = response?.purchase?.permalink;\r\n    return { quantity, success: response.success, permalink, isAppSumo };\r\n  };\r\n\r\n  serverHandler = async (params) => {\r\n    const data = {\r\n      quantity: 1,\r\n      website: window.location?.origin,\r\n      product: this.db,\r\n      email: this.info?.email,\r\n      action: \"add\",\r\n      ...params,\r\n    };\r\n\r\n    const response = await fetch(this.endpoint, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify(data),\r\n    })\r\n      .then((res) => res.json())\r\n      .then((res) => res);\r\n\r\n    return response;\r\n  };\r\n\r\n  activeLicense = async (license_key, products) => {\r\n    const { permalink, success, quantity, isAppSumo } = await this.verifyGumroad(products, license_key);\r\n    if (success) {\r\n      const { active, message } = await this.serverHandler({ license_key, quantity, isAppSumo });\r\n      if (active) {\r\n        const data = new FormData();\r\n        data.append(\"action\", `${this.prefix}_active_license_key`);\r\n        data.append(\"activated\", 1);\r\n        data.append(\"license_key\", license_key);\r\n        data.append(\"permalink\", permalink);\r\n        const activatePlugin = await fetch(this.info?.ajaxUrl, {\r\n          method: \"POST\",\r\n          body: data,\r\n        })\r\n          .then((res) => res.json())\r\n          .then((res) => res);\r\n        return activatePlugin?.success;\r\n      } else {\r\n        this.setNotice(\"notice-warning\", message);\r\n      }\r\n    } else {\r\n      this.setNotice(\"notice-warning\", \"Invalid License key\");\r\n    }\r\n  };\r\n\r\n  deactiveLicense = async (license_key, products) => {\r\n    const { permalink, success, quantity, isAppSumo } = await this.verifyGumroad(products, license_key);\r\n\r\n    if (success) {\r\n      const deactivated = await this.serverHandler({ license_key, action: \"deactive\" });\r\n      if (deactivated) {\r\n        const data = new FormData();\r\n        data.append(\"action\", `${this.prefix}_active_license_key`);\r\n        data.append(\"activated\", 0);\r\n        data.append(\"license_key\", \"\");\r\n\r\n        const deactivate = await fetch(this.info?.ajaxUrl, {\r\n          method: \"POST\",\r\n          body: data,\r\n        })\r\n          .then((res) => res.json())\r\n          .then((res) => res);\r\n        return deactivate?.success;\r\n      } else {\r\n        this.setNotice(\"notice-warning\", \"something went wrong!\");\r\n      }\r\n    } else {\r\n      this.setNotice(\"notice-warning\", \"invalid license key!\");\r\n    }\r\n  };\r\n\r\n  setNotice(classes, noticeText) {\r\n    const noticeParent = this.modal.querySelector(\".license_notice\");\r\n    const notice = document.createElement(\"div\");\r\n    notice.classList = `notice ${classes}`;\r\n    notice.innerText = noticeText;\r\n    noticeParent.appendChild(notice);\r\n    setTimeout(() => {\r\n      notice.remove();\r\n      if (classes == \"notice-success\") {\r\n        location.reload();\r\n      }\r\n    }, 3000);\r\n\r\n    // setTimeout(() => {\r\n    //   if (classes == \"notice-success\") {\r\n    //     location.reload();\r\n    //   }\r\n    // }, 1000);\r\n    return;\r\n  }\r\n\r\n  getQuantity = (response) => {\r\n    const variants = {\r\n      \"(Single Site)\": 1,\r\n      \"(3 Sites)\": 3,\r\n      \"(5 Sites)\": 5,\r\n      \"(Developer  - Unlimited)\": 1000,\r\n      \"(Developer)\": 1000,\r\n    };\r\n    let quantity = variants[response?.purchase?.variants] || 1;\r\n\r\n    return quantity;\r\n  };\r\n}\r\n\r\nexport default LicenseHandler;\r\n","import \"./../css/license.scss\";\r\nimport LicenseHandler from \"./../../../utils/license/license\";\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function () {\r\n  const licenseWrapper = document.querySelector(\".bpllch5ap_license_popup\");\r\n  new LicenseHandler(licenseWrapper, {\r\n    products: [\"h5ap\", \"h5app\", \"h5ap2\"],\r\n    prefix: \"bpllch5ap\",\r\n    info: bpllch5ap,\r\n    db: \"h5ap\",\r\n  });\r\n});\r\n"],"names":["constructor","modal","options","arguments","length","undefined","console","error","products","prefix","info","db","this","endpoint","opener","document","querySelector","closer","agree","activateBtn","deactivateBtn","loader","headers","window","license","addEventListener","e","preventDefault","style","display","disabled","checked","async","field","value","activeLicense","setNotice","deactiveLicense","verifyGumroad","_this","key","response","product","res","fetch","method","body","JSON","stringify","product_permalink","license_key","then","json","success","quantity","getQuantity","isAppSumo","purchase","product_name","includes","permalink","serverHandler","data","website","location","origin","email","action","params","active","message","FormData","append","activatePlugin","ajaxUrl","deactivate","classes","noticeText","noticeParent","notice","createElement","classList","innerText","appendChild","setTimeout","remove","reload","variants","licenseWrapper","LicenseHandler","bpllch5ap"],"sourceRoot":""}